<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Galería de Videos DVR Hikvision</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      color: white;
      background-color: #000;
      text-align: center;
      min-height: 100vh;
      position: relative;
    }

    .fondo {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    .contenido {
      position: relative;
      z-index: 1;
      min-height: 80vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .logo {
      width: 300px;
      height: auto;
      margin-bottom: 40px;
      animation: aparecerZoom 8s ease-out forwards, flotar 10s ease-in-out infinite;
      opacity: 0;
    }

    @keyframes aparecerZoom {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes flotar {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    .titulo {
      font-size: 2.5rem;
      color: #f9fafa;
      animation: entrada 8s ease-out forwards, brillo 10s infinite alternate;
      opacity: 0;
    }

    @keyframes entrada {
      0% { transform: translateY(-50px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }

    @keyframes brillo {
      0% { text-shadow: 0 0 5px #021a15, 0 0 10px #02130f; }
      100% { text-shadow: 0 0 15px #031411, 0 0 30px #011612; }
    }

    .botonera {
      position: fixed;
      top: 0;
      right: 0;
      display: flex;
      gap: 10px;
      padding: 15px 20px;
      background: transparent;
      z-index: 10;
    }

    .botonera button {
      padding: 10px 18px;
      font-size: 14px;
      border: none;
      background-color: transparent;
      color: #131010;
      border-radius: 6px;
      cursor: pointer;
      transition: color 0.3s ease, text-shadow 0.3s ease;
    }

    .botonera button:hover {
      color: #ebf3f3;
      text-shadow: 0 0 20px #04f7d7;
    }

    .galeria {
      position: relative;
      z-index: 2;
      margin-top: 40px;
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      justify-items: center;
    }

    .video-card {
      border: 2px solid white;
      border-radius: 10px;
      padding: 10px;
      width: 300px;
      background: rgba(0,0,0,0.6);
    }

    video {
      max-width: 100%;
      border-radius: 5px;
      display: none;
    }

    .pagarBtn {
      padding: 10px 20px;
      margin-top: 10px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background: #04f7d7;
      color: #000;
      font-weight: bold;
    }

    .pagarBtn:hover {
      background: #02c4a7;
      color: #fff;
    }

    #loginBtn {
      margin: 20px 0;
      padding: 10px 20px;
      background: #4285F4;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- Imagen de fondo -->
  <img class="fondo" src="src/image/fondo2.jpg" alt="Fondo">

  <!-- Contenido principal arriba -->
  <div class="contenido">
    <img class="logo" src="src/image/logo1.png" alt="Logo centrado animado">
    <h1 class="titulo">¡TUTORIALES DE SISTEMAS DE ALARMA DSC!</h1>
  </div>

  <!-- Botonera -->
  <div class="botonera">
    <button onclick="location.href='index.html'">Inicio</button>
    <button onclick="location.href='tutorialesdvrhikvision.html'">Tutoriales DVR HIKVISION</button>
    <button onclick="location.href='tutorialesdvrdahua.html'">Tutoriales DVR DAHUA</button>
    <button onclick="location.href='tutorialesdsc.html'">Tutoriales SISTEMA DE ALARMA DSC</button>
    <button onclick="location.href='tutorialesparadox.html'">Tutoriales SISTEMA DE PARADOX</button>
    <button onclick="location.href='tutorialesincendio.html'">Tutoriales SISTEMA DE INCENDIO</button>
    <button onclick="location.href='contactos.html'">CONTACTOS</button>
  </div>

  <!-- Sección videos debajo -->
  <button id="loginBtn">Iniciar sesión con Google</button>

  <div class="galeria" id="galeria">
    <div class="video-card" data-video="video1">
      <video controls>
        <source src="src/raw/video1.mp4" type="video/mp4">
      </video>
      <button class="pagarBtn">Pagar $2</button>
    </div>

    <div class="video-card" data-video="video2">
      <video controls>
        <source src="src/raw/video2.mp4" type="video/mp4">
      </video>
      <button class="pagarBtn">Pagar $2</button>
    </div>

    <div class="video-card" data-video="video3">
      <video controls>
        <source src="src/raw/video3.mp4" type="video/mp4">
      </video>
      <button class="pagarBtn">Pagar $2</button>
    </div>
  </div>

  <script type="module">
    import { auth, provider, db } from './firebase-config.js';
    import { signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    const loginBtn = document.getElementById('loginBtn');
    let userUid = null;

    // Login con Google
    loginBtn.addEventListener('click', async () => {
      const result = await signInWithPopup(auth, provider);
      userUid = result.user.uid;

      // Crear doc si no existe
      const userRef = doc(db, 'users', userUid);
      const userSnap = await getDoc(userRef);
      if (!userSnap.exists()) {
        await setDoc(userRef, { videosPagados: [] });
      }

      loginBtn.style.display = 'none';
      checkVideos();
    });

    // Verifica si el usuario tiene videos desbloqueados
    const checkVideos = async () => {
      if (!userUid) return;
      const userRef = doc(db, 'users', userUid);
      const userSnap = await getDoc(userRef);
      const videosPagados = userSnap.data()?.videosPagados || [];

      document.querySelectorAll('.video-card').forEach(card => {
        const videoId = card.getAttribute('data-video');
        const videoTag = card.querySelector('video');
        const btn = card.querySelector('.pagarBtn');

        if (videosPagados.includes(videoId)) {
          videoTag.style.display = 'block';
          btn.style.display = 'none';
        } else {
          videoTag.style.display = 'none';
          btn.style.display = 'inline-block';
        }
      });
    };

    onAuthStateChanged(auth, user => {
      if (user) {
        userUid = user.uid;
        loginBtn.style.display = 'none';
        checkVideos();
      }
    });

    // Botones de pago
    document.querySelectorAll('.pagarBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const videoId = btn.closest('.video-card').getAttribute('data-video');
        window.open(`https://www.mercadopago.com.uy/checkout/v1/redirect?pref_id=TU_PREF_ID_DEL_VIDEO_${videoId}`, '_blank');
        alert("Después de pagar, el video se desbloqueará automáticamente.");
      });
    });
  </script>

</body>
</html>
