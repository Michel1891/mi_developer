<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manuales de Caddx NX8</title>

<style>
body{
  background:#034164b9;
  margin:0;
  font-family:Arial,sans-serif;
  color:#fff;
  padding-top:100px;
}

/* HEADER */
header{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  background:rgba(3,65,100,.95);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 20px;
  z-index:1000;
  box-shadow:0 2px 10px rgba(0,0,0,.4);
}
.header-left{display:flex;align-items:center;gap:15px}
.logo-header{width:50px;height:50px;border-radius:50%}
.user-avatar{width:45px;height:45px;border-radius:50%;border:2px solid #00b4d8}
#btnLogout{background:#00b4d8;color:#fff;border:none;border-radius:6px;padding:8px 14px;cursor:pointer}

/* PANEL */
.container{
  background:rgba(53,47,47,.75);
  max-width:360px;
  margin:20px auto;
  padding:40px;
  border-radius:15px;
  box-shadow:0 0 20px #fff;
  text-align:center;
}
.logo{width:240px;margin-bottom:15px}
button{
  background:#00b4d8;
  color:#fff;
  padding:10px 15px;
  border:none;
  border-radius:6px;
  margin:10px;
  cursor:pointer;
}
.bloqueado{
  display:none;
  background:rgba(0,0,0,.7);
  padding:15px;
  border-radius:10px;
  color:#ff7777;
}

/* CONTENIDO */
.videos-container{
  max-width:450px;
  width:90%;
  margin:30px auto;
  padding:25px;
  background:rgba(53,47,47,.75);
  border-radius:15px;
  box-shadow:0 0 20px #fff;
  display:none;
  opacity:0;
  transition:.5s;
}
.videos-container.show{opacity:1}
.videos-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:20px;
}
.video-card{
  background:rgba(0,0,0,.45);
  padding:15px;
  border-radius:15px;
  text-align:center;
  box-shadow:0 0 10px rgba(0,180,216,.5);
}
video{width:100%;border-radius:10px}

/* VISOR PDF */
#pdfViewerContainer{
  max-width:1100px;
  width:95%;
  height:80vh;
  margin:30px auto;
  background:rgba(0,0,0,.9);
  border-radius:15px;
  box-shadow:0 0 25px #00b4d8;
  display:none;
  flex-direction:column;
}
#pdfHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 15px;
  background:rgba(0,180,216,.25);
  border-radius:15px 15px 0 0;
}
#pdfFrame{
  width:100%;
  height:100%;
  border:none;
  border-radius:0 0 15px 15px;
}
</style>
</head>

<body>

<header>
  <div class="header-left">
    <img src="src/image/logo4.png" class="logo-header">
    <h2>ğŸ“„Manuales de Caddx NX8</h2>
  </div>
  <div>
    <img src="src/image/default-user.png" class="user-avatar">
    <button id="btnLogout">Salir</button>
  </div>
</header>

<div class="container">
  <img src="src/image/logo4.png" class="logo">
  <h2>ğŸ“„Manuales de Caddx Nx8</h2>
  <button id="btnIngresar">ğŸšª Ingrese para visualizar contenido</button>

  <div id="bloqueo" class="bloqueado">
    âš ï¸ Debes tener una suscripciÃ³n activa<br><br>
    <a style="color:#00b4d8"
       href="https://www.mercadopago.com.uy/subscriptions/checkout?preapproval_plan_id=80b9657a5e7040b794c98f5d55ce4a6e">
       Activar suscripciÃ³n
    </a>
  </div>
</div>

<!-- PDFs -->
<div class="videos-container" id="pdfs">
<h2>ğŸ“„Manuales de Caddx Nx8</h2>
<div class="videos-grid">
  <div class="video-card">
    <h3>ğŸ“„Manual de Programacion de Caddx Nx8</h3>
    <button onclick="abrirPDF('Manual')">Ver PDF</button>
  </div>
  <div class="video-card">
    <h3>ğŸ“„ GuÃ­a rÃ¡pida de Caddx Nx8</h3>
    <button onclick="abrirPDF('Guia')">Ver PDF</button>
  </div>
  <div class="video-card">
    <h3>ğŸ“„ Preguntas frecuentes de Caddx Nx8</h3>
    <button onclick="abrirPDF('Preguntas')">Ver PDF</button>
  </div>
  <div class="video-card">
    <h3>ğŸ“„ Manual de Usuario de Caddx Nx8</h3>
    <button onclick="abrirPDF('Usuario')">Ver PDF</button>
  </div>
  <div class="video-card">
    <h3>ğŸ“„ Listado de falla de Caddx Nx8</h3>
    <button onclick="abrirPDF('Falla')">Ver PDF</button>
  </div>
</div>
</div>

    </div>
    </div>
<!-- VISOR PDF -->
<div id="pdfViewerContainer">
  <div id="pdfHeader">
    <strong>ğŸ“„ Documento</strong>
    <button onclick="cerrarPDF()">Cerrar âœ–</button>
  </div>
  <iframe id="pdfFrame"></iframe>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig={
  apiKey:"AIzaSyB_0_PIpdto8u1touBZNVoHiago6M2akoc",
  authDomain:"manualix-1d0fc.firebaseapp.com",
  projectId:"manualix-1d0fc",
  messagingSenderId:"847110946549",
  appId:"1:847110946549:web:0a507851fef1d9df6ccfbc"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

/* CONTROL DE ACCESO */
let accesoPermitido=false;

const bloques=[
  document.getElementById("pdfs"),
  document.getElementById("bloque1")
];

const bloqueo=document.getElementById("bloqueo");

/* PDFs LOCALES */
const pdfs={
  Manual:"https://firebasestorage.googleapis.com/v0/b/manualix-1d0fc.firebasestorage.app/o/Tutoriales%2FArchivosPdf%2FCADDXNX8%2FManualdeProgramacionCADDX%2FMANUAL_NX_8E.pdf?alt=media&token=5ab253e4-a918-4c30-ba27-387fafcbc8e0",
  Guia:"https://firebasestorage.googleapis.com/v0/b/manualix-1d0fc.firebasestorage.app/o/Tutoriales%2FArchivosPdf%2FCADDXNX8%2FGuiaRapidaCADDX%2FGuia%20Rapida%20Caddx%20Nx.pdf?alt=media&token=0cb2be61-191b-4f6a-98f9-22b21a5b89c2",
  Preguntas:"https://firebasestorage.googleapis.com/v0/b/manualix-1d0fc.firebasestorage.app/o/Tutoriales%2FArchivosPdf%2FCADDXNX8%2FPreguntasFrecuentesCADDX%2FPreguntas%20frecuentes%20CADDX.pdf?alt=media&token=9282e738-1137-44fe-8539-016d37b59c39",
  Usuario:"https://firebasestorage.googleapis.com/v0/b/manualix-1d0fc.firebasestorage.app/o/Tutoriales%2FArchivosPdf%2FCADDXNX8%2FManualdeUsuarioCADDX%2FCaddx_NX_Led_Usuario.pdf?alt=media&token=bab99b26-7593-444c-87de-da2a52d5ff39",
  Falla:"https://firebasestorage.googleapis.com/v0/b/manualix-1d0fc.firebasestorage.app/o/Tutoriales%2FArchivosPdf%2FCADDXNX8%2FListaFallaCADDX%2FListado%20de%20falla%20de%20caddx.pdf?alt=media&token=f216c079-63e1-4e54-8fa2-2e67aea75c9e"
};

/* ABRIR PDF (SOLO CON SUSCRIPCIÃ“N) */
window.abrirPDF=(id)=>{
  if(!accesoPermitido){
    alert("Debes tener una suscripciÃ³n activa.");
    return;
  }
  const frame=document.getElementById("pdfFrame");
  const visor=document.getElementById("pdfViewerContainer");
  frame.src=pdfs[id];
  visor.style.display="flex";
  visor.scrollIntoView({behavior:"smooth"});
};

window.cerrarPDF=()=>{
  document.getElementById("pdfFrame").src="";
  document.getElementById("pdfViewerContainer").style.display="none";
};

/* BOTÃ“N INGRESAR */
document.getElementById("btnIngresar").onclick=async()=>{
  const user=auth.currentUser;
  if(!user)return;

  const snap=await getDoc(doc(db,"suscripciones",user.email));

  if(snap.exists() && snap.data().activa===true){
    accesoPermitido=true;
    bloqueo.style.display="none";
    bloques.forEach(b=>{
      b.style.display="block";
      setTimeout(()=>b.classList.add("show"),100);
    });
  }else{
    accesoPermitido=false;
    bloqueo.style.display="block";
  }
};

/* AUTO-VALIDACIÃ“N AL RECARGAR */
onAuthStateChanged(auth,async(user)=>{
  if(!user)return;
  const snap=await getDoc(doc(db,"suscripciones",user.email));
  if(snap.exists() && snap.data().activa===true){
    accesoPermitido=true;
  }
});

/* LOGOUT */
document.getElementById("btnLogout").onclick=async()=>{
  await signOut(auth);
  location.reload();
};
</script>

</body>
</html>

